# FinanceManager CLI  
**Консольный менеджер личных финансов**  

Приложение позволяет учитывать доходы и расходы, устанавливать лимиты по категориям, просматривать статистику и управлять несколькими пользователями через консольный интерфейс.

---

## 🚀 Инструкция по запуску

Из корня проекта выполните команды:

```bash
./gradlew dependencies --refresh-dependencies
./gradlew build
./gradlew :fatJar
java -jar ./build/libs/financial-manager.jar
```

---

## 💡 Пример использования (пошагово)

```
signup anton 123
Пользователь anton успешно создан
login anton 123
Успешно выполнен вход пользователем anton
limit -n мой-первый-лимит -c еда 40000
Лимит мой-первый-лимит успешно создан для категории еда
limit -n мой-второй-лимит -c образование -from 2025-10-09T22:04 -to 2025-12-09T22:04 40000
Лимит мой-второй-лимит успешно создан для категории образование
transaction -c еда -30000 росал
Транзакция успешно добавлена
Расходы превысили ваши доходы, ваш текущий баланс -30000
transaction -c еда -30000 росал
После выполнения транзакции следующие лимиты будут переполнены мой-первый-лимит
Да - выполнить транзакцию
Нет - отменить
да
Транзакция успешно добавлена
Превышен лимит на категорию мой-первый-лимит (40000) на 20000
Расходы превысили ваши доходы, ваш текущий баланс -60000
transaction -c образование -5000 университет
Транзакция успешно добавлена
Расходы превысили ваши доходы, ваш текущий баланс -65000
transaction -c ЗП 10000 Работа
Транзакция успешно добавлена
transaction-list
┌───────────┬────────┬───────────┬────────────────┐
│Категория  │Величина│Откуда/Куда│Время           │
├───────────┼────────┼───────────┼────────────────┤
│еда        │-30000  │росал      │2025-11-10T14:35│
│еда        │-30000  │росал      │2025-11-10T14:36│
│образование│-5000   │университет│2025-11-10T14:37│
│ЗП         │10000.0 │Работа     │2025-11-10T14:38│
└───────────┴────────┴───────────┴────────────────┘
transaction-list -incoming
┌─────────┬────────┬───────────┬────────────────┐
│Категория│Величина│Откуда/Куда│Время           │
├─────────┼────────┼───────────┼────────────────┤
│ЗП       │10000.0 │Работа     │2025-11-10T14:38│
└─────────┴────────┴───────────┴────────────────┘
transaction-list -outcoming
┌───────────┬────────┬───────────┬────────────────┐
│Категория  │Величина│Откуда/Куда│Время           │
├───────────┼────────┼───────────┼────────────────┤
│еда        │-30000  │росал      │2025-11-10T14:35│
│еда        │-30000  │росал      │2025-11-10T14:36│
│образование│-5000   │университет│2025-11-10T14:37│
└───────────┴────────┴───────────┴────────────────┘
transaction-list -c ЗП,еда
┌───────────┬────────┬───────────┬────────────────┐
│Категория  │Величина│Откуда/Куда│Время           │
├───────────┼────────┼───────────┼────────────────┤
│еда        │-30000  │росал      │2025-11-10T14:35│
│еда        │-30000  │росал      │2025-11-10T14:36│
│ЗП         │10000.0 │Работа     │2025-11-10T14:38│
└───────────┴────────┴───────────┴────────────────┘
stats -c еда
┌─────────────────────────────┬──────┐
│Максимальное поступление     │0     │
│Максимальное списание        │-30000│
│Сумма поступлений            │0     │
│Сумма списаний               │-60000│
│Число операций по начислению │0     │
│Число операций по списанию   │2     │
│Сумма всех операций          │-60000│
│Среднее списание             │-30000│
│Переполнений лимитов         │1     │
└─────────────────────────────┴──────┘
limit-list
┌────────────────┬───────────┬────────┬────────────────┬────────────────┐
│Наименование    │Категория  │Величина│Время с         │Время до        │
├────────────────┼───────────┼────────┼────────────────┼────────────────┤
│мой-первый-лимит│еда        │40000   │2025-11-10T14:34│-               │
│мой-второй-лимит│образование│40000   │2025-10-09T22:04│2025-12-09T22:04│
└────────────────┴───────────┴────────┴────────────────┴────────────────┘
limit-list -c еда
┌────────────────┬─────────┬────────┬────────────────┬────────┐
│Наименование    │Категория│Величина│Время с         │Время до│
├────────────────┼─────────┼────────┼────────────────┼────────┤
│мой-первый-лимит│еда      │40000   │2025-11-10T14:34│-       │
└────────────────┴─────────┴────────┴────────────────┴────────┘
logout
Вы вышли из аккаунта anton
\q
```

---

## ⚙️ Зависимости

```
id("com.diffplug.spotless") version "6.25.0"
implementation("org.springframework:spring-context:6.2.12")
implementation("de.vandermeer:asciitable:0.3.2")
implementation("ch.qos.logback:logback-classic:1.4.14")
implementation("com.fasterxml.jackson.core:jackson-databind:2.17.2")
implementation("com.fasterxml.jackson.core:jackson-annotations:2.17.2")
implementation("com.fasterxml.jackson.datatype:jackson-datatype-jsr310:2.17.2")
compileOnly("org.projectlombok:lombok:1.18.34")
annotationProcessor("org.projectlombok:lombok:1.18.34")
testImplementation(platform("org.junit:junit-bom:5.10.0"))
testImplementation("org.junit.jupiter:junit-jupiter")
testImplementation("org.mockito:mockito-core:5.12.0")
testImplementation("org.mockito:mockito-inline:5.2.0")
testRuntimeOnly("org.junit.platform:junit-platform-launcher")
```

---

## 🧱 Архитектура проекта

- **CLIReader** — парсинг аргументов из консоли в объекты команд.  
- **FSM (Finite State Machine)** — конечный автомат, управляющий состояниями приложения (`AuthState`, `WorkingState`).  
- **AppState** — хранение текущего пользователя, набора зарегистрированных пользователей и состояния FSM.  
- **AppFsmImpl** — диспетчер, который определяет, какой алгоритм обработки команды вызвать.  
- **Сервисы (Services)**:  
  - `UserService` — управление пользователями и их аутентификацией.  
  - `TransactionService` — добавление и фильтрация транзакций, проверка лимитов.  
  - `LimitService` — создание и проверка лимитов по категориям.  
  - `StatsService` — статистика по операциям (доходы, расходы, средние значения).  

### Логика работы

1. Пользователь вводит команду (например, `transaction -c еда -30000`).  
2. CLIReader преобразует её в объект `CLICommand`.  
3. FSM проверяет, можно ли выполнить эту команду в текущем состоянии.  
4. Алгоритм (`CLICommandProcessingAlg`) вызывает нужный сервис.  
5. Сервисы обновляют состояние (`AppState`) и возвращают результат.  
6. Данные выводятся в виде ASCII-таблиц в консоль.  

---

## 🧪 Тестирование

Проект покрыт модульными и интеграционными тестами с использованием **JUnit 5** и **Mockito**.  
Проверяются сценарии:  
- Регистрация и логин пользователей.  
- Добавление транзакций и проверка переполнения лимитов.  
- Формирование статистики и фильтрация по дате и категориям.  
- Работоспособность конечного автомата (FSM) и смена состояний.  
